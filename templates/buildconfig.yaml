apiVersion: build.openshift.io/v1
kind: BuildConfig
metadata:
  name: bcbsfl-nginx-inline-build
  labels:
    app: bcbsfl-nginx-inline
  annotations:
    argocd.argoproj.io/sync-wave: "1"   # <--- precedence: BuildConfig first
spec:
  # --- SOURCE: INLINE DOCKERFILE, NO GIT ---
  source:
    type: Dockerfile
    dockerfile: |
      FROM quay-enterprise.apps.ose4-dev.bcbsfl.com/ocp-image/nginx-124-ubi9

      USER 0
      RUN mkdir -p /usr/share/nginx/html && \
          printf '%s\n' \
            '<!DOCTYPE html>' \
            '<html>' \
            '  <head><title>BCBSFL Nginx Demo</title></head>' \
            '  <body><h1>welcome to bcbsfl</h1></body>' \
            '</html>' \
            > /usr/share/nginx/html/index.html && \
          chmod 644 /usr/share/nginx/html/index.html
      USER 1001

  # --- BUILD STRATEGY: DOCKER ---
  strategy:
    type: Docker
    dockerStrategy: {}

  # --- OUTPUT: PUSH IMAGE TO QUAY ---
  output:
    to:
      kind: DockerImage
      name: quay-enterprise.apps.ose4-dev.bcbsfl.com/n5bp/argocd-cicd:pavan3
    pushSecret:
      name: n5bp-test-pull-secret

  # --- TRIGGERS ---
  triggers:
    - type: ConfigChange




    ------


    spec:
  # --- SOURCE: INLINE DOCKERFILE, NO GIT ---
  source:
    type: Dockerfile
    dockerfile: |
      FROM quay-enterprise.apps0e4-dev.bcbsfl.com/ocp-image/nginx-124-ubi9

      # run as root to write files
      USER 0
      RUN mkdir -p /usr/share/nginx/html && \
          printf '%s\n' \
          '<!DOCTYPE html>' \
          '<html>' \
          '  <head><title>BCBSFL Nginx Demo</title></head>' \
          '  <body><h1>Welcome to bcbfsfl</h1></body>' \
          '</html>' \
          > /usr/share/nginx/html/index.html && \
          chmod 644 /usr/share/nginx/html/index.html

      # drop back to non-root user (same as base image)
      USER 1001

      # container should listen on 8080
      EXPOSE 8080

      # **important**: keep nginx running in foreground
      CMD ["nginx", "-g", "daemon off;"]

  # --- BUILD STRATEGY: DOCKER ---
  strategy:
    type: Docker
    dockerStrategy: {}

